{"version":3,"file":"index.js","sources":["../lib/utils.ts","../lib/ViewportCollector.tsx","../lib/ViewportProvider.tsx","../lib/ObserveViewport.tsx","../lib/ConnectViewport.tsx","../lib/ObserveBoundingClientRect.tsx","../lib/hooks.ts","../lib/index.ts"],"sourcesContent":["import { Rect, Scroll, Dimensions, OnUpdateType } from './types';\n\nexport const shallowEqualScroll = (a: Scroll, b: Scroll) => {\n  if (a === b) {\n    return true;\n  }\n  return (\n    a.x === b.x &&\n    a.y === b.y &&\n    a.xTurn === b.xTurn &&\n    a.yTurn === b.yTurn &&\n    a.xDTurn === b.xDTurn &&\n    a.yDTurn === b.yDTurn &&\n    a.isScrollingUp === b.isScrollingUp &&\n    a.isScrollingDown === b.isScrollingDown &&\n    a.isScrollingLeft === b.isScrollingLeft &&\n    a.isScrollingRight === b.isScrollingRight\n  );\n};\n\nexport const shallowEqualRect = (a: Rect, b: Rect) => {\n  if (a === b) {\n    return true;\n  }\n\n  return (\n    a.top === b.top &&\n    a.right === b.right &&\n    a.bottom === b.bottom &&\n    a.left === b.left &&\n    a.height === b.height &&\n    a.width === b.width\n  );\n};\n\nexport const shallowEqualDimensions = (a: Dimensions, b: Dimensions) => {\n  if (a === b) {\n    return true;\n  }\n\n  return (\n    a.width === b.width &&\n    a.height === b.height &&\n    a.clientWidth === b.clientWidth &&\n    a.clientHeight === b.clientHeight &&\n    a.outerWidth === b.outerWidth &&\n    a.outerHeight === b.outerHeight &&\n    a.documentWidth === b.documentWidth &&\n    a.documentHeight === b.documentHeight\n  );\n};\n\n// implementation based on https://github.com/WICG/EventListenerOptions/blob/gh-pages/explainer.md\nexport const browserSupportsPassiveEvents = (() => {\n  if (typeof window === 'undefined') {\n    return false;\n  }\n  let supportsPassive = false;\n  try {\n    const opts = Object.defineProperty({}, 'passive', {\n      get: () => {\n        supportsPassive = true;\n      },\n    });\n    window.addEventListener('testPassive', null as any, opts);\n    window.removeEventListener('testPassive', null as any, opts);\n  } catch (e) {\n    return false;\n  }\n  return supportsPassive;\n})();\n\nexport const simpleDebounce = <F extends (...args: any[]) => any>(\n  fn: F,\n  delay: number,\n): F => {\n  let timeout: NodeJS.Timer;\n  return ((...args: any[]) => {\n    clearTimeout(timeout);\n    timeout = setTimeout(fn, delay, ...args);\n  }) as F;\n};\n\nexport const debounceOnUpdate = (\n  fn: OnUpdateType,\n  delay: number,\n): OnUpdateType => {\n  let timeout: NodeJS.Timer;\n  let scrollDidUpdate = false;\n  let dimensionsDidUpdate = false;\n\n  return (viewport, options) => {\n    clearTimeout(timeout);\n    scrollDidUpdate = scrollDidUpdate || options.scrollDidUpdate;\n    dimensionsDidUpdate = dimensionsDidUpdate || options.dimensionsDidUpdate;\n    timeout = setTimeout(() => {\n      fn(viewport, {\n        scrollDidUpdate,\n        dimensionsDidUpdate,\n      });\n      scrollDidUpdate = false;\n      dimensionsDidUpdate = false;\n    }, delay);\n  };\n};\n\nexport const warnNoContextAvailable = (location: string) => {\n  if (process.env.NODE_ENV === 'production') {\n    return;\n  }\n  const fromHook = location.startsWith('use');\n  if (fromHook) {\n    console.warn(\n      `react-viewport-utils: ${location} hook is not able to connect to a <ViewportProvider>. Therefore it cannot detect updates from the viewport and will not work as expected. To resolve this issue please add a <ViewportProvider> as a parent of the component using the hook, e.g. directly in the ReactDOM.render call:\n\nimport * as ReactDOM from 'react-dom';\nimport { ViewportProvider, ${location} } from 'react-viewport-utils';\n\nconst MyComponent = () => {\n  ${location}()\n  ...\n}\n\nReactDOM.render(\n  <ViewportProvider>\n    <main role=\"main\">\n      <MyComponent />\n    </main>\n  </ViewportProvider>,\n  document.getElementById('root')\n);`,\n    );\n    return;\n  }\n  console.warn(\n    `react-viewport-utils: ${location} component is not able to connect to a <ViewportProvider>. Therefore it cannot detect updates from the viewport and will not work as expected. To resolve this issue please add a <ViewportProvider> as a parent of the <ObserveViewport> component, e.g. directly in the ReactDOM.render call:\n\nimport * as ReactDOM from 'react-dom';\nimport { ViewportProvider, ObserveViewport } from 'react-viewport-utils';\nReactDOM.render(\n  <ViewportProvider>\n    <main role=\"main\">\n      <ObserveViewport>\n        {({ scroll, dimensions }) => ...}\n      </ObserveViewport>\n    </main>\n  </ViewportProvider>,\n  document.getElementById('root')\n);`,\n  );\n};\n\nexport const warnNoResizeObserver = () => {\n  if (process.env.NODE_ENV === 'production') {\n    return;\n  }\n  console.warn(\n    'react-viewport-utils: This browser does not support the ResizeObserver API, therefore not all possible resize events will be detected. In most of the cases this is not an issue and can be ignored. If its relevant to your application please consider adding a polyfill, e.g. https://www.npmjs.com/package/resize-observer-polyfill .',\n  );\n};\n\ntype RequestAnimationFrameType = (callback: FrameRequestCallback) => number;\n\nexport const requestAnimationFrame = ((): RequestAnimationFrameType => {\n  if (typeof window !== 'undefined') {\n    const nativeRAF =\n      window.requestAnimationFrame ||\n      window.webkitRequestAnimationFrame ||\n      (<any>window).mozRequestAnimationFrame;\n    if (nativeRAF) {\n      return nativeRAF.bind(window);\n    }\n  }\n  return function requestAnimationFrameFallback(\n    callback: FrameRequestCallback,\n  ): number {\n    return (setTimeout(callback, 1000 / 60) as unknown) as number;\n  };\n})();\n\nexport const cancelAnimationFrame = ((): ((handle: number) => void) => {\n  if (typeof window !== 'undefined') {\n    const nativeCAF =\n      window.cancelAnimationFrame ||\n      window.webkitCancelAnimationFrame ||\n      (<any>window).webkitCancelRequestAnimationFrame;\n    if (nativeCAF) {\n      return nativeCAF.bind(window);\n    }\n  }\n  return clearTimeout;\n})();\n\nexport const now =\n  typeof performance !== 'undefined' && performance.now\n    ? performance.now.bind(performance)\n    : Date.now.bind(Date);\nexport const createPerformanceMarker = () => {\n  const start = now();\n  return () => now() - start;\n};\n","import * as React from 'react';\nimport memoize from 'memoize-one';\n\nimport {\n  shallowEqualScroll,\n  shallowEqualDimensions,\n  browserSupportsPassiveEvents,\n  simpleDebounce,\n  debounceOnUpdate,\n  warnNoResizeObserver,\n  requestAnimationFrame,\n  cancelAnimationFrame,\n} from './utils';\n\nimport { Dimensions, Scroll, Viewport, OnUpdateType } from './types';\n\nexport const getClientDimensions = (): Dimensions => {\n  if (typeof document === 'undefined' || !document.documentElement) {\n    return createEmptyDimensionState();\n  }\n  const { innerWidth, innerHeight, outerWidth, outerHeight } = window;\n  const {\n    clientWidth,\n    clientHeight,\n    scrollHeight,\n    scrollWidth,\n    offsetHeight,\n    offsetWidth,\n  } = document.documentElement;\n  return {\n    width: innerWidth,\n    height: innerHeight,\n    clientWidth,\n    clientHeight,\n    outerWidth,\n    outerHeight,\n    documentWidth: Math.max(scrollWidth, offsetWidth, clientWidth),\n    documentHeight: Math.max(scrollHeight, offsetHeight, clientHeight),\n  };\n};\n\nconst getNodeScroll = (elem = window) => {\n  let { scrollX, scrollY } = elem;\n  if (scrollX === undefined) {\n    scrollX = elem.pageXOffset;\n  }\n  if (scrollY === undefined) {\n    scrollY = elem.pageYOffset;\n  }\n\n  return {\n    x: scrollX,\n    y: scrollY,\n  };\n};\n\nexport const getClientScroll = (\n  prevScrollState: Scroll = createEmptyScrollState(),\n) => {\n  if (typeof window === 'undefined') {\n    return createEmptyScrollState();\n  }\n  const { x, y } = getNodeScroll();\n  const nextScrollState = { ...prevScrollState };\n  const {\n    isScrollingLeft: prevIsScrollingLeft,\n    isScrollingUp: prevIsScrollingUp,\n    xTurn: prevXTurn,\n    yTurn: prevYTurn,\n  } = prevScrollState;\n\n  nextScrollState.isScrollingLeft = isScrollingLeft(x, nextScrollState);\n  nextScrollState.isScrollingRight = isScrollingRight(x, nextScrollState);\n\n  nextScrollState.isScrollingUp = isScrollingUp(y, nextScrollState);\n  nextScrollState.isScrollingDown = isScrollingDown(y, nextScrollState);\n\n  nextScrollState.xTurn =\n    nextScrollState.isScrollingLeft === prevIsScrollingLeft ? prevXTurn : x;\n  nextScrollState.yTurn =\n    nextScrollState.isScrollingUp === prevIsScrollingUp ? prevYTurn : y;\n\n  nextScrollState.xDTurn = x - nextScrollState.xTurn;\n  nextScrollState.yDTurn = y - nextScrollState.yTurn;\n\n  nextScrollState.x = x;\n  nextScrollState.y = y;\n\n  return nextScrollState;\n};\n\nconst isScrollingLeft = (x: number, prev: Scroll) => {\n  switch (true) {\n    case x < prev.x:\n      return true;\n    case x > prev.x:\n      return false;\n    case x === prev.x:\n      return prev.isScrollingLeft;\n    default:\n      throw new Error('Could not calculate isScrollingLeft');\n  }\n};\n\nconst isScrollingRight = (x: number, prev: Scroll) => {\n  switch (true) {\n    case x > prev.x:\n      return true;\n    case x < prev.x:\n      return false;\n    case x === prev.x:\n      return prev.isScrollingRight;\n    default:\n      throw new Error('Could not calculate isScrollingRight');\n  }\n};\n\nconst isScrollingUp = (y: number, prev: Scroll) => {\n  switch (true) {\n    case y < prev.y:\n      return true;\n    case y > prev.y:\n      return false;\n    case y === prev.y:\n      return prev.isScrollingUp;\n    default:\n      throw new Error('Could not calculate isScrollingUp');\n  }\n};\n\nconst isScrollingDown = (y: number, prev: Scroll) => {\n  switch (true) {\n    case y > prev.y:\n      return true;\n    case y < prev.y:\n      return false;\n    case y === prev.y:\n      return prev.isScrollingDown;\n    default:\n      throw new Error('Could not calculate isScrollingDown');\n  }\n};\n\nexport const createEmptyScrollState = () => ({\n  x: 0,\n  y: 0,\n  isScrollingUp: false,\n  isScrollingDown: false,\n  isScrollingLeft: false,\n  isScrollingRight: false,\n  xTurn: 0,\n  yTurn: 0,\n  xDTurn: 0,\n  yDTurn: 0,\n});\n\nexport const createEmptyDimensionState = (): Dimensions => ({\n  width: 0,\n  height: 0,\n  clientWidth: 0,\n  clientHeight: 0,\n  outerWidth: 0,\n  outerHeight: 0,\n  documentWidth: 0,\n  documentHeight: 0,\n});\n\ninterface IProps {\n  onUpdate: OnUpdateType;\n  onIdledUpdate?: OnUpdateType;\n}\n\nexport default class ViewportCollector extends React.PureComponent<IProps> {\n  private scrollState: Scroll;\n  private dimensionsState: Dimensions;\n  private lastSyncedScrollState: Scroll;\n  private lastSyncedDimensionsState: Dimensions;\n  private tickId?: number;\n  private scrollMightHaveUpdated: boolean;\n  private resizeMightHaveUpdated: boolean;\n  private resizeObserver: ResizeObserver | null;\n  public syncedStateOnce: boolean;\n\n  constructor(props: IProps) {\n    super(props);\n    this.state = {\n      parentProviderExists: false,\n    };\n    this.scrollMightHaveUpdated = false;\n    this.resizeMightHaveUpdated = false;\n    this.scrollState = createEmptyScrollState();\n    this.dimensionsState = createEmptyDimensionState();\n    this.lastSyncedDimensionsState = { ...this.dimensionsState };\n    this.lastSyncedScrollState = { ...this.scrollState };\n    this.resizeObserver = null;\n    this.syncedStateOnce = false;\n  }\n\n  componentDidMount() {\n    const options = browserSupportsPassiveEvents ? { passive: true } : false;\n    window.addEventListener('scroll', this.handleScroll, options);\n    window.addEventListener('resize', this.handleResizeDebounce, options);\n    window.addEventListener(\n      'orientationchange',\n      this.handleResizeDebounce,\n      options,\n    );\n\n    if (typeof window.ResizeObserver !== 'undefined') {\n      this.resizeObserver = new window.ResizeObserver(\n        this.handleResizeDebounce,\n      );\n      this.resizeObserver!.observe(document.body);\n    } else {\n      warnNoResizeObserver();\n    }\n\n    this.handleScroll();\n    this.handleResize();\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.handleScroll, false);\n    window.removeEventListener('resize', this.handleResizeDebounce, false);\n    window.removeEventListener(\n      'orientationchange',\n      this.handleResizeDebounce,\n      false,\n    );\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n      this.resizeObserver = null;\n    }\n    if (typeof this.tickId === 'number') {\n      cancelAnimationFrame(this.tickId);\n    }\n  }\n\n  tick = () => {\n    if (this) {\n      if (this.scrollMightHaveUpdated || this.resizeMightHaveUpdated) {\n        this.syncState();\n        this.scrollMightHaveUpdated = false;\n        this.resizeMightHaveUpdated = false;\n      }\n      this.tickId = undefined;\n    }\n  };\n\n  handleScroll = () => {\n    this.scrollMightHaveUpdated = true;\n    if (!this.tickId) {\n      this.tickId = requestAnimationFrame(this.tick);\n    }\n  };\n\n  handleResize = () => {\n    this.resizeMightHaveUpdated = true;\n    if (!this.tickId) {\n      this.tickId = requestAnimationFrame(this.tick);\n    }\n  };\n\n  handleResizeDebounce = simpleDebounce(this.handleResize, 88);\n\n  getPublicScroll = memoize(\n    (scroll: Scroll): Scroll => ({ ...scroll }),\n    ([a]: [Scroll], [b]: [Scroll]) => shallowEqualScroll(a, b),\n  );\n\n  getPublicDimensions = memoize(\n    (dimensions: Dimensions): Dimensions => ({ ...dimensions }),\n    ([a]: [Dimensions], [b]: [Dimensions]) => shallowEqualDimensions(a, b),\n  );\n\n  syncState = () => {\n    if (!this.syncedStateOnce) {\n      this.syncedStateOnce = true;\n    }\n    if (this.scrollMightHaveUpdated) {\n      Object.assign(this.scrollState, getClientScroll(this.scrollState));\n    }\n    if (this.resizeMightHaveUpdated) {\n      Object.assign(this.dimensionsState, getClientDimensions());\n    }\n    const scrollDidUpdate =\n      this.scrollMightHaveUpdated &&\n      !shallowEqualScroll(this.lastSyncedScrollState, this.scrollState);\n    const dimensionsDidUpdate =\n      this.resizeMightHaveUpdated &&\n      !shallowEqualDimensions(\n        this.lastSyncedDimensionsState,\n        this.dimensionsState,\n      );\n\n    if (scrollDidUpdate) {\n      this.lastSyncedScrollState = { ...this.scrollState };\n    }\n\n    if (dimensionsDidUpdate) {\n      this.lastSyncedDimensionsState = { ...this.dimensionsState };\n    }\n\n    if (scrollDidUpdate || dimensionsDidUpdate) {\n      const publicState = this.getPropsFromState();\n      this.props.onUpdate(publicState, {\n        scrollDidUpdate,\n        dimensionsDidUpdate,\n      });\n      this.updateOnIdle(publicState, {\n        scrollDidUpdate,\n        dimensionsDidUpdate,\n      });\n    }\n  };\n\n  updateOnIdle = debounceOnUpdate((...args) => {\n    if (typeof this.props.onIdledUpdate === 'function') {\n      this.props.onIdledUpdate(...args);\n    }\n  }, 166);\n\n  getPropsFromState(): Viewport {\n    return {\n      scroll: this.getPublicScroll(this.lastSyncedScrollState),\n      dimensions: this.getPublicDimensions(this.lastSyncedDimensionsState),\n    };\n  }\n\n  render() {\n    return null;\n  }\n}\n","import * as React from 'react';\n\nimport {\n  ViewportChangeHandler,\n  ViewportChangeOptions,\n  Viewport,\n  ViewportCollectorUpdateOptions,\n} from './types';\nimport ViewportCollector, {\n  getClientDimensions,\n  getClientScroll,\n} from './ViewportCollector';\nimport {\n  createPerformanceMarker,\n  now,\n  requestAnimationFrame,\n  cancelAnimationFrame,\n} from './utils';\n\ninterface Props {\n  experimentalSchedulerEnabled?: boolean;\n  experimentalSchedulerLayoutCalculatorEnabled?: boolean;\n}\n\ninterface Listener extends ViewportChangeOptions {\n  handler: ViewportChangeHandler;\n  iterations: number;\n  initialized: boolean;\n  averageExecutionCost: number;\n  skippedIterations: number;\n}\n\nconst createFallbackViewportRequester = () => {\n  let defaultValue: Viewport;\n  let lastAccess = 0;\n  return (): Viewport => {\n    if (!defaultValue || now() - lastAccess > 1000) {\n      defaultValue = {\n        scroll: getClientScroll(),\n        dimensions: getClientDimensions(),\n      };\n      lastAccess = now();\n    }\n    return defaultValue;\n  };\n};\n\nexport const ViewportContext = React.createContext({\n  removeViewportChangeListener: (handler: ViewportChangeHandler) => {},\n  scheduleReinitializeChangeHandler: (handler: ViewportChangeHandler) => {},\n  addViewportChangeListener: (\n    handler: ViewportChangeHandler,\n    options: ViewportChangeOptions,\n  ) => {},\n  getCurrentViewport: createFallbackViewportRequester(),\n  hasRootProviderAsParent: false,\n  version: '__VERSION__',\n});\n\nconst maxIterations = (priority: 'highest' | 'high' | 'normal' | 'low') => {\n  switch (priority) {\n    case 'highest':\n      return 0;\n    case 'high':\n      return 4;\n    case 'normal':\n      return 16;\n    case 'low':\n      return 64;\n  }\n};\n\nconst shouldSkipIteration = (\n  { priority: getPriority, averageExecutionCost, skippedIterations }: Listener,\n  budget: number,\n): boolean => {\n  const priority = getPriority();\n  if (priority === 'highest') {\n    return false;\n  }\n  if (priority !== 'low' && averageExecutionCost <= budget) {\n    return false;\n  }\n  if (averageExecutionCost <= budget / 10) {\n    return false;\n  }\n  const probability = skippedIterations / maxIterations(priority);\n  if (probability >= 1) {\n    return false;\n  }\n  return Math.random() > probability;\n};\n\nexport default class ViewportProvider extends React.PureComponent<\n  Props,\n  { hasListeners: boolean }\n> {\n  static defaultProps: {\n    experimentalSchedulerEnabled: false;\n    experimentalSchedulerLayoutCalculatorEnabled: false;\n  };\n  private listeners: Listener[] = [];\n  private updateListenersTick?: NodeJS.Timer;\n  private initializeListenersTick?: number;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      hasListeners: false,\n    };\n  }\n\n  componentWillUnmount() {\n    if (typeof this.updateListenersTick === 'number') {\n      clearTimeout(this.updateListenersTick);\n    }\n    if (typeof this.initializeListenersTick === 'number') {\n      cancelAnimationFrame(this.initializeListenersTick);\n    }\n  }\n\n  triggerUpdateToListeners = (\n    state: Viewport,\n    { scrollDidUpdate, dimensionsDidUpdate }: ViewportCollectorUpdateOptions,\n    options?: { isIdle?: boolean; shouldInitialize?: boolean },\n  ) => {\n    const getOverallDuration = createPerformanceMarker();\n    const { isIdle, shouldInitialize } = Object.assign(\n      { isIdle: false, shouldInitialize: false },\n      options,\n    );\n    let updatableListeners = this.listeners.filter(\n      ({\n        notifyScroll,\n        notifyDimensions,\n        notifyOnlyWhenIdle,\n        skippedIterations,\n        initialized,\n      }) => {\n        const needsUpdate = skippedIterations > 0;\n        if (notifyOnlyWhenIdle() !== isIdle && !needsUpdate) {\n          return false;\n        }\n        if (shouldInitialize && !initialized) {\n          return true;\n        }\n        const updateForScroll = notifyScroll() && scrollDidUpdate;\n        const updateForDimensions = notifyDimensions() && dimensionsDidUpdate;\n        return updateForScroll || updateForDimensions;\n      },\n    );\n    if (this.props.experimentalSchedulerEnabled) {\n      if (!isIdle) {\n        const budget = 16 / updatableListeners.length;\n        updatableListeners = updatableListeners.filter(listener => {\n          const skip = listener.initialized\n            ? shouldSkipIteration(listener, budget)\n            : false;\n          if (skip) {\n            listener.skippedIterations++;\n            return false;\n          }\n          listener.skippedIterations = 0;\n          return true;\n        });\n      }\n    }\n    const layouts = updatableListeners.map(\n      ({ recalculateLayoutBeforeUpdate }) => {\n        if (recalculateLayoutBeforeUpdate) {\n          const getDuration = createPerformanceMarker();\n          const layoutState = recalculateLayoutBeforeUpdate(state);\n          return [layoutState, getDuration()] as const;\n        }\n        return null;\n      },\n    );\n    let overallJSHandlerTotalCost = 0;\n    updatableListeners.forEach((listener, index) => {\n      const { handler, averageExecutionCost, iterations } = listener;\n      const [layout, layoutCost] = layouts[index] || [null, 0];\n\n      const getDuration = createPerformanceMarker();\n      handler(state, layout);\n      const totalCost = layoutCost + getDuration();\n      const diff = totalCost - averageExecutionCost;\n      const i = iterations + 1;\n\n      listener.averageExecutionCost = averageExecutionCost + diff / i;\n      listener.iterations = i;\n      listener.initialized = true;\n      overallJSHandlerTotalCost += totalCost;\n    });\n    if (\n      this.props.experimentalSchedulerLayoutCalculatorEnabled &&\n      updatableListeners.length\n    ) {\n      setTimeout(() => {\n        const diffPerHandler =\n          (getOverallDuration() - overallJSHandlerTotalCost) /\n          updatableListeners.length;\n        updatableListeners.forEach(listener => {\n          listener.averageExecutionCost =\n            listener.averageExecutionCost +\n            diffPerHandler / listener.iterations;\n        });\n      }, 0);\n    }\n  };\n\n  addViewportChangeListener = (\n    handler: ViewportChangeHandler,\n    options: ViewportChangeOptions,\n  ) => {\n    this.listeners.push({\n      handler,\n      iterations: 0,\n      averageExecutionCost: 0,\n      skippedIterations: 0,\n      initialized: false,\n      ...options,\n    });\n    this.handleListenerUpdate();\n  };\n\n  scheduleReinitializeChangeHandler = (h: ViewportChangeHandler) => {\n    const listener = this.listeners.find(({ handler }) => handler === h);\n    if (listener && listener.initialized) {\n      listener.initialized = false;\n      this.handleListenerUpdate();\n    }\n  };\n\n  removeViewportChangeListener = (h: ViewportChangeHandler) => {\n    this.listeners = this.listeners.filter(({ handler }) => handler !== h);\n    this.handleListenerUpdate();\n  };\n\n  handleListenerUpdate() {\n    if (this.updateListenersTick === undefined) {\n      this.updateListenersTick = setTimeout(() => {\n        const nextState = this.listeners.length !== 0;\n        if (this.state.hasListeners !== nextState) {\n          this.setState({\n            hasListeners: this.listeners.length !== 0,\n          });\n        }\n        this.updateListenersTick = undefined;\n      }, 1);\n    }\n    if (this.initializeListenersTick === undefined) {\n      this.initializeListenersTick = requestAnimationFrame(() => {\n        if (\n          this.collector.current &&\n          this.collector.current.syncedStateOnce &&\n          this.listeners.some(l => !l.initialized)\n        ) {\n          this.triggerUpdateToListeners(\n            this.collector.current.getPropsFromState(),\n            {\n              dimensionsDidUpdate: false,\n              scrollDidUpdate: false,\n            },\n            {\n              isIdle: false,\n              shouldInitialize: true,\n            },\n          );\n        }\n        this.initializeListenersTick = undefined;\n      });\n    }\n  }\n\n  private collector = React.createRef<ViewportCollector>();\n  private getCurrentDefaultViewport = createFallbackViewportRequester();\n  private contextValue = {\n    addViewportChangeListener: this.addViewportChangeListener,\n    removeViewportChangeListener: this.removeViewportChangeListener,\n    scheduleReinitializeChangeHandler: this.scheduleReinitializeChangeHandler,\n    getCurrentViewport: () => {\n      if (this.collector.current && this.collector.current.syncedStateOnce) {\n        return this.collector.current.getPropsFromState();\n      }\n      return this.getCurrentDefaultViewport();\n    },\n    hasRootProviderAsParent: true,\n    version: '__VERSION__',\n  };\n\n  renderChildren = (props: {\n    hasRootProviderAsParent: boolean;\n    version: string;\n  }) => {\n    if (props.hasRootProviderAsParent) {\n      if (\n        process.env.NODE_ENV !== 'production' &&\n        props.version !== '__VERSION__'\n      ) {\n        console.warn(\n          `react-viewport-utils: Two different versions of the react-viewport-utils library are used in the same react tree. This can lead to unexpected results as the versions might not be compatible.\nThe <ViewportProvider> of version ${props.version} is currently used, another <ViewportProvider> of version __VERSION__ was detected but is ignored.\nThis is most probably due to some dependencies that use different versions of the react-viewport-utils library. You can check if an update is possible.`,\n        );\n      }\n      return this.props.children;\n    }\n    return (\n      <React.Fragment>\n        {this.state.hasListeners && (\n          <ViewportCollector\n            ref={this.collector}\n            onUpdate={this.triggerUpdateToListeners}\n            onIdledUpdate={(state, updates) =>\n              this.triggerUpdateToListeners(state, updates, { isIdle: true })\n            }\n          />\n        )}\n        <ViewportContext.Provider value={this.contextValue}>\n          {this.props.children}\n        </ViewportContext.Provider>\n      </React.Fragment>\n    );\n  };\n\n  render() {\n    return (\n      <ViewportContext.Consumer>{this.renderChildren}</ViewportContext.Consumer>\n    );\n  }\n}\n","import * as React from 'react';\n\nimport { ViewportContext } from './ViewportProvider';\nimport {\n  createEmptyDimensionState,\n  createEmptyScrollState,\n} from './ViewportCollector';\nimport {\n  Scroll,\n  Dimensions,\n  Viewport,\n  ViewportChangeHandler,\n  ViewportChangeOptions,\n  PriorityType,\n} from './types';\nimport {\n  warnNoContextAvailable,\n  requestAnimationFrame,\n  cancelAnimationFrame,\n} from './utils';\n\ninterface ChildProps {\n  scroll: Scroll | null;\n  dimensions: Dimensions | null;\n}\n\ninterface State extends ChildProps {}\n\ninterface Props {\n  children?: (props: ChildProps) => React.ReactNode;\n  onUpdate?: (props: ChildProps, layoutSnapshot: unknown) => void;\n  recalculateLayoutBeforeUpdate?: (props: ChildProps) => unknown;\n  disableScrollUpdates: boolean;\n  disableDimensionsUpdates: boolean;\n  deferUpdateUntilIdle: boolean;\n  priority: PriorityType;\n}\n\ninterface Context {\n  addViewportChangeListener: (\n    handler: ViewportChangeHandler,\n    options: ViewportChangeOptions,\n  ) => void;\n  removeViewportChangeListener: (handler: ViewportChangeHandler) => void;\n  scheduleReinitializeChangeHandler: (handler: ViewportChangeHandler) => void;\n  hasRootProviderAsParent: boolean;\n  getCurrentViewport: () => Viewport;\n  version: string;\n}\n\nexport default class ObserveViewport extends React.Component<Props, State> {\n  private removeViewportChangeListener?: (\n    handler: ViewportChangeHandler,\n  ) => void;\n  private scheduleReinitializeChangeHandler?: (\n    handler: ViewportChangeHandler,\n  ) => void;\n\n  private tickId?: number;\n  private nextViewport?: Viewport;\n\n  static defaultProps: Props = {\n    disableScrollUpdates: false,\n    disableDimensionsUpdates: false,\n    deferUpdateUntilIdle: false,\n    priority: 'normal',\n  };\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      scroll: createEmptyScrollState(),\n      dimensions: createEmptyDimensionState(),\n    };\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const dimensionsBecameActive =\n      !this.props.disableDimensionsUpdates &&\n      prevProps.disableDimensionsUpdates;\n    const scrollBecameActive =\n      !this.props.disableScrollUpdates && prevProps.disableScrollUpdates;\n    if (\n      typeof this.scheduleReinitializeChangeHandler === 'function' &&\n      (dimensionsBecameActive || scrollBecameActive)\n    ) {\n      this.scheduleReinitializeChangeHandler(this.handleViewportUpdate);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.removeViewportChangeListener) {\n      this.removeViewportChangeListener(this.handleViewportUpdate);\n    }\n    this.removeViewportChangeListener = undefined;\n    this.scheduleReinitializeChangeHandler = undefined;\n    if (typeof this.tickId === 'number') {\n      cancelAnimationFrame(this.tickId);\n    }\n  }\n\n  handleViewportUpdate = (viewport: Viewport, layoutSnapshot: unknown) => {\n    if (this.props.onUpdate) {\n      this.props.onUpdate(viewport, layoutSnapshot);\n    }\n\n    if (this.props.children) {\n      this.syncState(viewport);\n    }\n  };\n\n  syncState(nextViewport: Viewport) {\n    this.nextViewport = nextViewport;\n    if (this.tickId === undefined) {\n      this.tickId = requestAnimationFrame(() => {\n        if (this.nextViewport) {\n          this.setState(this.nextViewport);\n        }\n        this.tickId = undefined;\n        this.nextViewport = undefined;\n      });\n    }\n  }\n\n  get optionNotifyScroll(): boolean {\n    return !this.props.disableScrollUpdates;\n  }\n\n  get optionNotifyDimensions(): boolean {\n    return !this.props.disableDimensionsUpdates;\n  }\n\n  registerViewportListeners = ({\n    addViewportChangeListener,\n    removeViewportChangeListener,\n    scheduleReinitializeChangeHandler,\n    hasRootProviderAsParent,\n    getCurrentViewport,\n  }: Context): React.ReactNode => {\n    if (!hasRootProviderAsParent) {\n      warnNoContextAvailable('ObserveViewport');\n      return null;\n    }\n\n    const shouldRegister =\n      this.removeViewportChangeListener !== removeViewportChangeListener;\n\n    if (!shouldRegister) {\n      return null;\n    }\n\n    if (this.removeViewportChangeListener) {\n      this.removeViewportChangeListener(this.handleViewportUpdate);\n    }\n\n    this.removeViewportChangeListener = removeViewportChangeListener;\n    this.scheduleReinitializeChangeHandler = scheduleReinitializeChangeHandler;\n    addViewportChangeListener(this.handleViewportUpdate, {\n      notifyScroll: () => !this.props.disableScrollUpdates,\n      notifyDimensions: () => !this.props.disableDimensionsUpdates,\n      notifyOnlyWhenIdle: () => this.props.deferUpdateUntilIdle,\n      priority: () => this.props.priority,\n      recalculateLayoutBeforeUpdate: (viewport: Viewport) => {\n        if (this.props.recalculateLayoutBeforeUpdate) {\n          return this.props.recalculateLayoutBeforeUpdate(viewport);\n        }\n        return null;\n      },\n    });\n\n    if (this.props.children) {\n      this.syncState(getCurrentViewport());\n    }\n\n    return null;\n  };\n\n  render() {\n    const { children } = this.props;\n    return (\n      <React.Fragment>\n        <ViewportContext.Consumer>\n          {this.registerViewportListeners}\n        </ViewportContext.Consumer>\n        {children ? children(this.state) : null}\n      </React.Fragment>\n    );\n  }\n}\n","import * as React from 'react';\n\nimport { IScroll, IDimensions } from './index';\nimport ObserveViewport from './ObserveViewport';\nimport { PriorityType } from './types';\n\ninterface InjectedProps {\n  scroll?: IScroll | null;\n  dimensions?: IDimensions | null;\n}\n\ntype OmitValues = 'scroll' | 'dimensions';\n\ninterface IOptions {\n  omit?: OmitValues[];\n  deferUpdateUntilIdle?: boolean;\n  priority?: PriorityType;\n}\n\nexport default function connect(options: IOptions = {}) {\n  const deferUpdateUntilIdle = Boolean(options.deferUpdateUntilIdle);\n  const omit = options.omit || [];\n  const shouldOmitScroll = omit.indexOf('scroll') !== -1;\n  const shouldOmitDimensions = omit.indexOf('dimensions') !== -1;\n  return <P extends object>(\n    WrappedComponent: React.ComponentType<P & InjectedProps>,\n  ): React.ComponentClass<P> => {\n    const displayName =\n      WrappedComponent.displayName || WrappedComponent.name || 'Component';\n    return class ConnectViewport extends React.Component<P, {}> {\n      static displayName = `connectViewport(${displayName})`;\n\n      render() {\n        return (\n          <ObserveViewport\n            disableScrollUpdates={shouldOmitScroll}\n            disableDimensionsUpdates={shouldOmitDimensions}\n            deferUpdateUntilIdle={deferUpdateUntilIdle}\n            priority={options.priority}\n          >\n            {({ scroll, dimensions }) => (\n              <WrappedComponent\n                scroll={scroll}\n                dimensions={dimensions}\n                {...this.props}\n              />\n            )}\n          </ObserveViewport>\n        );\n      }\n    };\n  };\n}\n","import * as React from 'react';\n\nimport {\n  shallowEqualRect,\n  requestAnimationFrame,\n  cancelAnimationFrame,\n} from './utils';\nimport { Rect } from './types';\n\ninterface Props {\n  /**\n   * Called every time when an update is detected. Same as\n   * using `onUpdate` but it requires to render a node.\n   */\n  children?: (rect: Rect | null) => React.ReactNode;\n  /**\n   * The reference to the node that should be observed\n   */\n  node: React.RefObject<HTMLElement>;\n  /**\n   * Called once a node is mounted for the first time.\n   */\n  onInit?: (rect: Rect) => void;\n  /**\n   * Called every time when an update is detected. Same as\n   * using `children` but it does not allow to render a node.\n   */\n  onUpdate?: (rect: Rect) => void;\n}\n\ninterface IState extends Rect {\n  isInitialized: boolean;\n}\n\n/**\n * @deprecated Use useRect or useRectEffect instead as it provides better performance.\n */\nexport default class ObserveBoundingClientRect extends React.PureComponent<\n  Props,\n  IState\n> {\n  private tickId?: number;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      top: 0,\n      right: 0,\n      bottom: 0,\n      left: 0,\n      height: 0,\n      width: 0,\n      isInitialized: false,\n    };\n  }\n\n  componentDidMount() {\n    this.tick(this.syncState);\n  }\n\n  componentDidUpdate(prevProps: Props, prevState: IState) {\n    const rect = this.getRectFromState();\n    const prevRect = this.getRectFromState(prevState);\n    if (!rect) {\n      return;\n    }\n\n    if (this.props.onInit) {\n      if (!prevState.isInitialized && this.state.isInitialized) {\n        this.props.onInit(rect);\n      }\n    }\n\n    if (this.props.onUpdate) {\n      if (prevRect === null || !shallowEqualRect(rect, prevRect)) {\n        this.props.onUpdate(rect);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (typeof this.tickId === 'number') {\n      cancelAnimationFrame(this.tickId);\n    }\n  }\n\n  tick(updater: Function) {\n    this.tickId = requestAnimationFrame(() => {\n      updater();\n      this.tick(updater);\n    });\n  }\n\n  getRectFromState(state: IState = this.state): Rect | null {\n    if (!state.isInitialized) {\n      return null;\n    }\n\n    return {\n      height: state.height,\n      width: state.width,\n      top: state.top,\n      bottom: state.bottom,\n      left: state.left,\n      right: state.right,\n    };\n  }\n\n  getRectFromNode(): Rect | null {\n    const { node } = this.props;\n    if (!node || !node.current) {\n      return null;\n    }\n\n    const rect = node.current.getBoundingClientRect();\n    return {\n      height: rect.height,\n      width: rect.width,\n      top: rect.top,\n      bottom: rect.bottom,\n      left: rect.left,\n      right: rect.right,\n    };\n  }\n\n  syncState = () => {\n    const { node } = this.props;\n    if (!node || !node.current) {\n      return;\n    }\n    const rect = this.getRectFromNode();\n\n    if (rect && !this.state.isInitialized) {\n      this.setState({ ...rect, isInitialized: true });\n      return;\n    }\n\n    this.setState(rect);\n  };\n\n  render() {\n    const { children } = this.props;\n    return typeof children === 'function'\n      ? children(this.getRectFromState())\n      : null;\n  }\n}\n","import {\n  useContext,\n  useEffect,\n  useState,\n  RefObject,\n  useRef,\n  DependencyList,\n} from 'react';\n\nimport { ViewportContext } from './ViewportProvider';\nimport { Viewport, Scroll, Dimensions, PriorityType, Rect } from './types';\nimport { warnNoContextAvailable } from './utils';\n\ninterface ViewPortEffectOptions<T> extends FullOptions {\n  recalculateLayoutBeforeUpdate?: (viewport: Viewport) => T;\n}\n\ninterface FullOptions extends IOptions {\n  disableScrollUpdates?: boolean;\n  disableDimensionsUpdates?: boolean;\n}\n\ninterface IOptions {\n  [key: string]: unknown;\n  deferUpdateUntilIdle?: boolean;\n  priority?: PriorityType;\n}\ninterface IEffectOptions<T> extends IOptions {\n  recalculateLayoutBeforeUpdate?: (viewport: Viewport) => T;\n}\n\nexport function useViewportEffect<T = unknown>(\n  handleViewportChange: (viewport: Viewport, snapshot: T) => void,\n  deps?: DependencyList,\n): void;\n\nexport function useViewportEffect<T = unknown>(\n  handleViewportChange: (viewport: Viewport, snapshot: T) => void,\n  options?: ViewPortEffectOptions<T>,\n  deps?: DependencyList,\n): void;\n\nexport function useViewportEffect<T>(\n  handleViewportChange: (viewport: Viewport, snapshot: T) => void,\n  second?: any,\n  third?: any,\n) {\n  const {\n    addViewportChangeListener,\n    removeViewportChangeListener,\n    hasRootProviderAsParent,\n  } = useContext(ViewportContext);\n  const { options, deps } = sortArgs(second, third);\n  const memoOptions = useOptions(options);\n\n  useEffect(() => {\n    if (!hasRootProviderAsParent) {\n      warnNoContextAvailable('useViewport');\n      return;\n    }\n    addViewportChangeListener(handleViewportChange, {\n      notifyScroll: () => !memoOptions.disableScrollUpdates,\n      notifyDimensions: () => !memoOptions.disableDimensionsUpdates,\n      notifyOnlyWhenIdle: () => Boolean(memoOptions.deferUpdateUntilIdle),\n      priority: () => memoOptions.priority || 'normal',\n      recalculateLayoutBeforeUpdate: (...args: any) =>\n        memoOptions.recalculateLayoutBeforeUpdate\n          ? memoOptions.recalculateLayoutBeforeUpdate(...args)\n          : null,\n    });\n    return () => removeViewportChangeListener(handleViewportChange);\n  }, [\n    addViewportChangeListener || null,\n    removeViewportChangeListener || null,\n    ...deps,\n  ]);\n}\n\nexport const useViewport = (options: FullOptions = {}): Viewport => {\n  const { getCurrentViewport } = useContext(ViewportContext);\n  const [state, setViewport] = useState(getCurrentViewport());\n  useViewportEffect(viewport => setViewport(viewport), options);\n\n  return state;\n};\n\nexport function useScrollEffect<T = unknown>(\n  effect: (scroll: Scroll, snapshot: T) => void,\n  deps?: DependencyList,\n): void;\n\nexport function useScrollEffect<T = unknown>(\n  effect: (scroll: Scroll, snapshot: T) => void,\n  options: IEffectOptions<T>,\n  deps?: DependencyList,\n): void;\n\nexport function useScrollEffect<T = unknown>(\n  effect: (scroll: Scroll, snapshot: T) => void,\n  second?: any,\n  third?: any,\n) {\n  const { options, deps } = sortArgs(second, third);\n  useViewportEffect(\n    (viewport, snapshot: T) => effect(viewport.scroll, snapshot),\n    {\n      disableDimensionsUpdates: true,\n      ...options,\n    },\n    deps,\n  );\n}\n\nexport const useScroll = (options: IOptions = {}): Scroll => {\n  const { scroll } = useViewport({\n    disableDimensionsUpdates: true,\n    ...options,\n  });\n\n  return scroll;\n};\n\nexport function useDimensionsEffect<T = unknown>(\n  effect: (dimensions: Dimensions, snapshot: T) => void,\n  deps?: DependencyList,\n): void;\n\nexport function useDimensionsEffect<T = unknown>(\n  effect: (dimensions: Dimensions, snapshot: T) => void,\n  options: IEffectOptions<T>,\n  deps?: DependencyList,\n): void;\n\nexport function useDimensionsEffect<T = unknown>(\n  effect: (dimensions: Dimensions, snapshot: T) => void,\n  second: any,\n  third?: any,\n) {\n  const { options, deps } = sortArgs(second, third);\n  useViewportEffect(\n    (viewport, snapshot: T) => effect(viewport.dimensions, snapshot),\n    {\n      disableScrollUpdates: true,\n      ...options,\n    },\n    deps,\n  );\n}\n\nexport const useDimensions = (options: IOptions = {}): Dimensions => {\n  const { dimensions } = useViewport({\n    disableScrollUpdates: true,\n    ...options,\n  });\n\n  return dimensions;\n};\n\nexport function useRectEffect(\n  effect: (rect: Rect | null) => void,\n  ref: RefObject<HTMLElement>,\n  deps?: DependencyList,\n): void;\n\nexport function useRectEffect(\n  effect: (rect: Rect | null) => void,\n  ref: RefObject<HTMLElement>,\n  options: FullOptions,\n  deps?: DependencyList,\n): void;\n\nexport function useRectEffect(\n  effect: (rect: Rect | null) => void,\n  ref: RefObject<HTMLElement>,\n  third?: any,\n  fourth?: any,\n) {\n  const { options, deps } = sortArgs(third, fourth);\n  useViewportEffect(\n    (_, snapshot) => effect(snapshot),\n    {\n      ...options,\n      recalculateLayoutBeforeUpdate: () =>\n        ref.current ? ref.current.getBoundingClientRect() : null,\n    },\n    [ref.current, ...deps],\n  );\n}\n\nexport function useRect(\n  ref: RefObject<HTMLElement>,\n  deps?: DependencyList,\n): Rect | null;\n\nexport function useRect(\n  ref: RefObject<HTMLElement>,\n  options: FullOptions,\n  deps?: DependencyList,\n): Rect | null;\n\nexport function useRect(\n  ref: RefObject<HTMLElement>,\n  second: any,\n  third?: any,\n): Rect | null {\n  const { options, deps } = sortArgs(second, third);\n  return useLayoutSnapshot(\n    () => (ref.current ? ref.current.getBoundingClientRect() : null),\n    options,\n    [ref.current, ...deps],\n  );\n}\n\nexport function useLayoutSnapshot<T = unknown>(\n  recalculateLayoutBeforeUpdate: (viewport: Viewport) => T,\n  deps?: DependencyList,\n): null | T;\n\nexport function useLayoutSnapshot<T = unknown>(\n  recalculateLayoutBeforeUpdate: (viewport: Viewport) => T,\n  options?: FullOptions,\n  deps?: DependencyList,\n): null | T;\n\nexport function useLayoutSnapshot<T = unknown>(\n  recalculateLayoutBeforeUpdate: (viewport: Viewport) => T,\n  second?: any,\n  third?: any,\n): null | T {\n  const { options, deps } = sortArgs(second, third);\n  const [state, setSnapshot] = useState<null | T>(null);\n  useViewportEffect(\n    (_, snapshot: T) => setSnapshot(snapshot),\n    {\n      ...options,\n      recalculateLayoutBeforeUpdate,\n    },\n    deps,\n  );\n\n  return state;\n}\n\nconst useOptions = <T>(o: ViewPortEffectOptions<T>) => {\n  const optionsRef = useRef<ViewPortEffectOptions<T>>(Object.create(null));\n  for (const key of Object.keys(optionsRef.current)) {\n    delete optionsRef.current[key];\n  }\n  Object.assign(optionsRef.current, o);\n\n  return optionsRef.current;\n};\n\nconst sortArgs = (\n  first: DependencyList | IOptions,\n  second?: DependencyList,\n) => {\n  let options = {};\n  if (first && !Array.isArray(first)) {\n    options = first;\n  }\n  let deps = second || [];\n  if (first && Array.isArray(first)) {\n    deps = first;\n  }\n  return { deps, options };\n};\n","export { default as ViewportProvider } from './ViewportProvider';\nexport { default as connectViewport } from './ConnectViewport';\nexport { default as ObserveBoundingClientRect } from './ObserveBoundingClientRect';\nexport { default as ObserveViewport } from './ObserveViewport';\nexport {\n  useScroll,\n  useScrollEffect,\n  useDimensions,\n  useDimensionsEffect,\n  useViewport,\n  useViewportEffect,\n  useLayoutSnapshot,\n  useRect,\n  useRectEffect,\n} from './hooks';\nexport { requestAnimationFrame, cancelAnimationFrame } from './utils';\nexport {\n  Rect as IRect,\n  Scroll as IScroll,\n  Dimensions as IDimensions,\n  Rect,\n  Scroll,\n  Dimensions,\n} from './types';\n\nexport const VERSION = '__VERSION__';\n"],"names":["React.PureComponent","React.createContext","React.createRef","React.createElement","React.Fragment","React.Component","useEffect","useRef"],"mappings":"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"}